"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ —Ç–æ–≤–∞—Ä–∞–º
"""
import asyncio
import asyncpg
import random
from datetime import datetime, timedelta

DATABASE_URL = "postgresql://postgres:postgres@localhost:5432/edu_na_bazar"

# –ò–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤
NAMES = [
    "–ê–Ω–Ω–∞", "–ú–∞—Ä–∏—è", "–ï–ª–µ–Ω–∞", "–û–ª—å–≥–∞", "–ù–∞—Ç–∞–ª—å—è", "–¢–∞—Ç—å—è–Ω–∞", "–ò—Ä–∏–Ω–∞", "–°–≤–µ—Ç–ª–∞–Ω–∞",
    "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", "–î–º–∏—Ç—Ä–∏–π", "–°–µ—Ä–≥–µ–π", "–ê–Ω–¥—Ä–µ–π", "–ê–ª–µ–∫—Å–µ–π", "–ú–∏—Ö–∞–∏–ª", "–ò–≤–∞–Ω", "–ù–∏–∫–æ–ª–∞–π",
    "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", "–Æ–ª–∏—è", "–í–∏–∫—Ç–æ—Ä–∏—è", "–î–∞—Ä—å—è", "–ê–Ω–∞—Å—Ç–∞—Å–∏—è", "–í–∞–ª–µ–Ω—Ç–∏–Ω–∞", "–õ—é–¥–º–∏–ª–∞",
    "–í–ª–∞–¥–∏–º–∏—Ä", "–ï–≤–≥–µ–Ω–∏–π", "–ü–∞–≤–µ–ª", "–†–æ–º–∞–Ω", "–ú–∞–∫—Å–∏–º", "–ê—Ä—Ç–µ–º", "–î–µ–Ω–∏—Å"
]

# –®–∞–±–ª–æ–Ω—ã –æ—Ç–∑—ã–≤–æ–≤
REVIEW_TEMPLATES = {
    "positive": [
        "–û—Ç–ª–∏—á–Ω—ã–π —Ç–æ–≤–∞—Ä! –û—á–µ–Ω—å –¥–æ–≤–æ–ª–µ–Ω –ø–æ–∫—É–ø–∫–æ–π. –†–µ–∫–æ–º–µ–Ω–¥—É—é!",
        "–ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –≤—ã—Å–æ—Ç–µ, —Ü–µ–Ω–∞ –ø—Ä–∏–µ–º–ª–µ–º–∞—è. –ë—É–¥—É –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å –µ—â–µ.",
        "–í—Å–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å! –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, —Ç–æ–≤–∞—Ä —Å–≤–µ–∂–∏–π.",
        "–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! –ò–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –∏—Å–∫–∞–ª. –°–ø–∞—Å–∏–±–æ –ø—Ä–æ–¥–∞–≤—Ü—É!",
        "–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é. 5 –∑–≤–µ–∑–¥!",
        "–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–∞ —Ç–∞–∫—É—é —Ü–µ–Ω—É. –°–æ–≤–µ—Ç—É—é –≤—Å–µ–º!",
        "–ü–æ–∫—É–ø–∞—é —É–∂–µ –Ω–µ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–µ–µ –∏ –≤–∫—É—Å–Ω–æ–µ.",
        "–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω–∞-–∫–∞—á–µ—Å—Ç–≤–æ. –†–µ–∫–æ–º–µ–Ω–¥—É—é!",
        "–í—Å–µ —Å—É–ø–µ—Ä! –¢–æ–≤–∞—Ä –ø—Ä–∏—à–µ–ª –±—ã—Å—Ç—Ä–æ, —É–ø–∞–∫–æ–≤–∫–∞ —Ö–æ—Ä–æ—à–∞—è.",
        "–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –≤—ã–±–æ—Ä! –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–º–µ–Ω–Ω–æ–µ, –±—É–¥—É –±—Ä–∞—Ç—å –µ—â–µ."
    ],
    "neutral": [
        "–ù–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –æ–∂–∏–¥–∞–ª –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.",
        "–í —Ü–µ–ª–æ–º –Ω–µ–ø–ª–æ—Ö–æ, –Ω–æ –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è.",
        "–¢–æ–≤–∞—Ä —Å—Ä–µ–¥–Ω–∏–π, —Ü–µ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤—É.",
        "–ü—Ä–∏–µ–º–ª–µ–º–æ, –Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø–æ–ø—Ä–æ–±—É—é —É –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞.",
        "–û–±—ã—á–Ω—ã–π —Ç–æ–≤–∞—Ä, –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ.",
        "–ö–∞—á–µ—Å—Ç–≤–æ —Å—Ä–µ–¥–Ω–µ–µ, –Ω–æ –∑–∞ —ç—Ç—É —Ü–µ–Ω—É –Ω–æ—Ä–º–∞–ª—å–Ω–æ.",
        "–ú–æ–∂–Ω–æ –±—Ä–∞—Ç—å, –Ω–æ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –ø–æ–ª—É—á—à–µ."
    ],
    "negative": [
        "–ù–µ –æ—á–µ–Ω—å —Å–≤–µ–∂–∏–π —Ç–æ–≤–∞—Ä, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω.",
        "–ö–∞—á–µ—Å—Ç–≤–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω–µ. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é.",
        "–û–∂–∏–¥–∞–ª –±–æ–ª—å—à–µ–≥–æ. –¢–æ–≤–∞—Ä –Ω–µ –≤–ø–µ—á–∞—Ç–ª–∏–ª.",
        "–ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∫–∞—á–µ—Å—Ç–≤–æ. –ë–æ–ª—å—à–µ –Ω–µ –∑–∞–∫–∞–∂—É.",
        "–¶–µ–Ω–∞ –∑–∞–≤—ã—à–µ–Ω–∞ –¥–ª—è —Ç–∞–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞."
    ]
}

# –®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞
SELLER_RESPONSES = [
    "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤! –†–∞–¥—ã, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å!",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –ø–æ–∫—É–ø–∫—É! –í—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞!",
    "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤—ã—Å–æ–∫—É—é –æ—Ü–µ–Ω–∫—É! –°—Ç–∞—Ä–∞–µ–º—Å—è –¥–ª—è –≤–∞—Å!",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –æ—Ç–∑—ã–≤! –ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞!",
    "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å! –£—á—Ç–µ–º –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è.",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –æ—Ç–∑—ã–≤! –†–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º –∫–∞—á–µ—Å—Ç–≤–∞.",
    "–°–ø–∞—Å–∏–±–æ! –†–∞–¥—ã, —á—Ç–æ –æ—Å—Ç–∞–ª–∏—Å—å –¥–æ–≤–æ–ª—å–Ω—ã –ø–æ–∫—É–ø–∫–æ–π!"
]

# –®–∞–±–ª–æ–Ω—ã –≤–æ–ø—Ä–æ—Å–æ–≤
QUESTIONS = [
    "–ö–∞–∫–æ–π —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏?",
    "–ï—Å—Ç—å –ª–∏ –≤ –Ω–∞–ª–∏—á–∏–∏?",
    "–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –æ–ø—Ç–æ–º?",
    "–ö–∞–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞?",
    "–î–æ—Å—Ç–∞–≤–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Ü–µ–Ω—É?",
    "–ï—Å—Ç—å –ª–∏ —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∑–∞–∫–∞–∑–µ?",
    "–ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è?",
    "–ú–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å —Å–∞–º–æ–≤—ã–≤–æ–∑–æ–º?",
    "–ï—Å—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞?",
    "–ö–∞–∫–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑?",
    "–°–≤–µ–∂–∏–π —Ç–æ–≤–∞—Ä?",
    "–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è –ø–æ—Å—Ç–∞–≤–∫–∞?",
    "–ú–æ–∂–Ω–æ –ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä?",
    "–ö–∞–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã?",
    "–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –ª–∏ –≤ –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞?"
]

# –®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
ANSWERS = [
    "–î–∞, –∫–æ–Ω–µ—á–Ω–æ! –í—Å–µ–≥–¥–∞ –≤ –Ω–∞–ª–∏—á–∏–∏.",
    "–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω –Ω–∞ —É–ø–∞–∫–æ–≤–∫–µ, –æ–±—ã—á–Ω–æ 5-7 –¥–Ω–µ–π.",
    "–î–∞, –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 10 –∫–≥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —Å–∫–∏–¥–∫—É 10%.",
    "–£–ø–∞–∫–æ–≤–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è.",
    "–î–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –æ—Ç 200 —Ä—É–±–ª–µ–π.",
    "–î–∞, –µ—Å—Ç—å —Å–∞–º–æ–≤—ã–≤–æ–∑ —Å –Ω–∞—à–µ–≥–æ —Å–∫–ª–∞–¥–∞.",
    "–í—Å–µ —Ç–æ–≤–∞—Ä—ã —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã.",
    "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑ –æ—Ç 1 –∫–≥.",
    "–î–∞, —Ç–æ–≤–∞—Ä –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–π, –ø–æ—Å—Ç–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.",
    "–ü—Ä–∏–Ω–∏–º–∞–µ–º –Ω–∞–ª–∏—á–Ω—ã–µ –∏ –∫–∞—Ä—Ç—ã.",
    "–î–∞, –¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏.",
    "–•—Ä–∞–Ω–∏—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ –ø—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ +2...+6¬∞C.",
    "–°–ª–µ–¥—É—é—â–∞—è –ø–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ 2-3 –¥–Ω—è.",
    "–í–æ–∑–≤—Ä–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.",
    "–î–∞, –æ–ø—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –æ—Ç 50 –∫–≥."
]

async def add_reviews_and_questions():
    """–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤—ã –∏ –≤–æ–ø—Ä–æ—Å—ã –∫ —Ç–æ–≤–∞—Ä–∞–º"""
    conn = await asyncpg.connect(DATABASE_URL)
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
        products = await conn.fetch("SELECT id, name FROM market.products")
        
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        users = await conn.fetch("SELECT id FROM config.users LIMIT 50")
        
        if not users:
            print("‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ")
            return
        
        print(f"üì¶ –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(products)}")
        print(f"üë• –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(users)}\n")
        
        total_reviews = 0
        total_questions = 0
        
        for product in products:
            product_id = product['id']
            product_name = product['name']
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç 2 –¥–æ 10 –æ—Ç–∑—ã–≤–æ–≤
            num_reviews = random.randint(2, 10)
            
            print(f"üìù {product_name}:")
            
            ratings = []
            
            for _ in range(num_reviews):
                # –°–ª—É—á–∞–π–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                user = random.choice(users)
                
                # –†–µ–π—Ç–∏–Ω–≥ (–±–æ–ª—å—à–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö)
                rating = random.choices([5, 4, 3, 2, 1], weights=[50, 30, 10, 7, 3])[0]
                ratings.append(rating)
                
                # –í—ã–±–∏—Ä–∞–µ–º —à–∞–±–ª–æ–Ω –æ—Ç–∑—ã–≤–∞
                if rating >= 4:
                    review_text = random.choice(REVIEW_TEMPLATES["positive"])
                elif rating == 3:
                    review_text = random.choice(REVIEW_TEMPLATES["neutral"])
                else:
                    review_text = random.choice(REVIEW_TEMPLATES["negative"])
                
                # –°–ª—É—á–∞–π–Ω–∞—è –¥–∞—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π)
                days_ago = random.randint(1, 60)
                created_at = datetime.now() - timedelta(days=days_ago)
                
                # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–∑—ã–≤
                review_id = await conn.fetchval("""
                    INSERT INTO market.product_reviews 
                    (product_id, user_id, rating, comment, created_at, updated_at)
                    VALUES ($1, $2, $3, $4, $5, $5)
                    RETURNING id
                """, product_id, user['id'], rating, review_text, created_at)
                
                # –û—Ç–≤–µ—Ç—ã –ø—Ä–æ–¥–∞–≤—Ü–∞ –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ —Å—Ö–µ–º–µ –ë–î
                
                total_reviews += 1
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞
            avg_rating = sum(ratings) / len(ratings)
            await conn.execute("""
                UPDATE market.products
                SET rating = $1, reviews_count = $2
                WHERE id = $3
            """, avg_rating, len(ratings), product_id)
            
            print(f"  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: {num_reviews}, —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: {avg_rating:.1f}")
            
            # –í–æ–ø—Ä–æ—Å—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º (—Ç–∞–±–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å)
        
        print(f"\nüéâ –í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:")
        print(f"  üìù –û—Ç–∑—ã–≤–æ–≤: {total_reviews}")
        print(f"  ‚ùì –í–æ–ø—Ä–æ—Å–æ–≤: {total_questions}")
        
    finally:
        await conn.close()

if __name__ == "__main__":
    print("üöÄ –ó–∞–ø—É—Å–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤...\n")
    asyncio.run(add_reviews_and_questions())
    print("\n‚úÖ –ì–æ—Ç–æ–≤–æ!")
