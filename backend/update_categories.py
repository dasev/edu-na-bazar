"""
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
"""
import psycopg2

conn_params = {
    'host': 'localhost',
    'port': 5432,
    'database': 'edu_na_bazar',
    'user': 'postgres',
    'password': 'postgres'
}

print("üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...")

try:
    conn = psycopg2.connect(**conn_params)
    conn.autocommit = True
    cur = conn.cursor()
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã
    print("üóëÔ∏è –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ...")
    cur.execute("DELETE FROM market.products")
    cur.execute("DELETE FROM market.categories")
    
    # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    print("\nüìÅ –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...")
    categories = [
        ('–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã', '–°–≤–µ–∂–∏–µ –æ–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã, –∑–µ–ª–µ–Ω—å'),
        ('–ú—è—Å–æ, –ø—Ç–∏—Ü–∞, —Ä—ã–±–∞', '–°–≤–µ–∂–µ–µ –º—è—Å–æ, –ø—Ç–∏—Ü–∞, —Ä—ã–±–∞'),
        ('–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã', '–ú–æ–ª–æ–∫–æ, —Å—ã—Ä, —Ç–≤–æ—Ä–æ–≥, –π–æ–≥—É—Ä—Ç—ã'),
        ('–ó–µ—Ä–Ω–æ', '–ö—Ä—É–ø—ã, –º—É–∫–∞, –∑–µ—Ä–Ω–æ–≤—ã–µ'),
        ('–ú–µ–¥', '–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –º–µ–¥ –∏ –ø—Ä–æ–¥—É–∫—Ç—ã –ø—á–µ–ª–æ–≤–æ–¥—Å—Ç–≤–∞'),
        ('–ì–æ—Ç–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã', '–ì–æ—Ç–æ–≤–∞—è –µ–¥–∞, –∫–æ–Ω—Å–µ—Ä–≤—ã, –∑–∞–≥–æ—Ç–æ–≤–∫–∏'),
    ]
    
    category_ids = []
    for name, desc in categories:
        cur.execute("""
            INSERT INTO market.categories (name, description, created_at, updated_at)
            VALUES (%s, %s, NOW(), NOW())
            RETURNING id
        """, (name, desc))
        cat_id = cur.fetchone()[0]
        category_ids.append((cat_id, name))
        print(f"  ‚úÖ {name} (ID: {cat_id})")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    print("\nüõí –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä—ã...")
    
    products = [
        # –û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã
        ('–Ø–±–ª–æ–∫–∏', '–°–≤–µ–∂–∏–µ —è–±–ª–æ–∫–∏ –ì—Ä–µ–Ω–Ω–∏ –°–º–∏—Ç', 89.90, category_ids[0][0]),
        ('–ë–∞–Ω–∞–Ω—ã', '–°–ø–µ–ª—ã–µ –±–∞–Ω–∞–Ω—ã', 69.90, category_ids[0][0]),
        ('–ü–æ–º–∏–¥–æ—Ä—ã', '–°–≤–µ–∂–∏–µ –ø–æ–º–∏–¥–æ—Ä—ã', 149.90, category_ids[0][0]),
        ('–û–≥—É—Ä—Ü—ã', '–•—Ä—É—Å—Ç—è—â–∏–µ –æ–≥—É—Ä—Ü—ã', 119.90, category_ids[0][0]),
        ('–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –º–æ–ª–æ–¥–æ–π', 45.90, category_ids[0][0]),
        
        # –ú—è—Å–æ, –ø—Ç–∏—Ü–∞, —Ä—ã–±–∞
        ('–ö—É—Ä–∏—Ü–∞', '–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–Ω–∞—è', 299.90, category_ids[1][0]),
        ('–ì–æ–≤—è–¥–∏–Ω–∞', '–ì–æ–≤—è–¥–∏–Ω–∞ –≤—ã—Ä–µ–∑–∫–∞', 599.90, category_ids[1][0]),
        ('–°–≤–∏–Ω–∏–Ω–∞', '–°–≤–∏–Ω–∏–Ω–∞ –∫–æ—Ä–µ–π–∫–∞', 399.90, category_ids[1][0]),
        ('–†—ã–±–∞', '–°–µ–º–≥–∞ —Å–≤–µ–∂–∞—è', 799.90, category_ids[1][0]),
        
        # –ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
        ('–ú–æ–ª–æ–∫–æ', '–ú–æ–ª–æ–∫–æ 3.2% 1–ª', 79.90, category_ids[2][0]),
        ('–°—ã—Ä', '–°—ã—Ä –†–æ—Å—Å–∏–π—Å–∫–∏–π', 399.90, category_ids[2][0]),
        ('–¢–≤–æ—Ä–æ–≥', '–¢–≤–æ—Ä–æ–≥ 9%', 129.90, category_ids[2][0]),
        ('–ô–æ–≥—É—Ä—Ç', '–ô–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π', 89.90, category_ids[2][0]),
        
        # –ó–µ—Ä–Ω–æ
        ('–ì—Ä–µ—á–∫–∞', '–ì—Ä–µ—á–∫–∞ —è–¥—Ä–∏—Ü–∞ 1–∫–≥', 89.90, category_ids[3][0]),
        ('–†–∏—Å', '–†–∏—Å –∫—Ä—É–≥–ª–æ–∑–µ—Ä–Ω—ã–π 1–∫–≥', 79.90, category_ids[3][0]),
        ('–ú—É–∫–∞', '–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è –≤—ã—Å—à–∏–π —Å–æ—Ä—Ç 2–∫–≥', 69.90, category_ids[3][0]),
        ('–û–≤—Å—è–Ω–∫–∞', '–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è 500–≥', 59.90, category_ids[3][0]),
        
        # –ú–µ–¥
        ('–ú–µ–¥ —Ü–≤–µ—Ç–æ—á–Ω—ã–π', '–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–µ–¥ 500–≥', 499.90, category_ids[4][0]),
        ('–ú–µ–¥ –ª–∏–ø–æ–≤—ã–π', '–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –ª–∏–ø–æ–≤—ã–π –º–µ–¥ 500–≥', 599.90, category_ids[4][0]),
        ('–ú–µ–¥ –≥—Ä–µ—á–∏—à–Ω—ã–π', '–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –≥—Ä–µ—á–∏—à–Ω—ã–π –º–µ–¥ 500–≥', 549.90, category_ids[4][0]),
        
        # –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
        ('–•–ª–µ–±', '–•–ª–µ–± –±–µ–ª—ã–π', 45.90, category_ids[5][0]),
        ('–ü–µ–ª—å–º–µ–Ω–∏', '–ü–µ–ª—å–º–µ–Ω–∏ –¥–æ–º–∞—à–Ω–∏–µ 500–≥', 199.90, category_ids[5][0]),
        ('–í–∞—Ä–µ–Ω–∏–∫–∏', '–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π 500–≥', 179.90, category_ids[5][0]),
        ('–ö–æ–Ω—Å–µ—Ä–≤—ã', '–¢—É—à–µ–Ω–∫–∞ –≥–æ–≤—è–∂—å—è 500–≥', 299.90, category_ids[5][0]),
    ]
    
    for name, desc, price, cat_id in products:
        cur.execute("""
            INSERT INTO market.products (name, description, price, category_id, in_stock, created_at, updated_at)
            VALUES (%s, %s, %s, %s, true, NOW(), NOW())
            RETURNING id
        """, (name, desc, price, cat_id))
        prod_id = cur.fetchone()[0]
        print(f"  ‚úÖ {name} - {price}‚ÇΩ")
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print("\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
    cur.execute("SELECT COUNT(*) FROM market.categories")
    print(f"  üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: {cur.fetchone()[0]}")
    
    cur.execute("SELECT COUNT(*) FROM market.products")
    print(f"  üõí –¢–æ–≤–∞—Ä–æ–≤: {cur.fetchone()[0]}")
    
    cur.close()
    conn.close()
    
    print("\n‚úÖ –ì–æ—Ç–æ–≤–æ! –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
    
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    import traceback
    traceback.print_exc()
