## üéâ –°–í–Ø–ó–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–´!

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. –°–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏
`extract_files_correct.py` - –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ë–ï–ó –∑–∞–º–µ–Ω—ã –Ω–∞ NULL

### 2. –°–≤—è–∑–∏ –Ω–∞–π–¥–µ–Ω—ã!
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –í—Å–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 9,753
   –° advert_id: 4,095 (42%) ‚úÖ
   –° company_id: 3,999 (41%) ‚úÖ
   –ë–µ–∑ —Å–≤—è–∑–µ–π: 5,658 (58%)
```

### 3. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π SQL —Ñ–∞–π–ª
`file_inserts_correct.sql` ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `file_inserts.sql`

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É temp.file
```bash
cd backend
python scripts\restart_migration.py
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```sql
DROP TABLE IF EXISTS temp.file CASCADE;
-- –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å migrate_to_temp_schema.py
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∏
```sql
SELECT 
    COUNT(*) as total,
    COUNT(CASE WHEN advert_id IS NOT NULL THEN 1 END) as with_advert,
    COUNT(CASE WHEN company_id IS NOT NULL THEN 1 END) as with_company
FROM temp.file
WHERE type = 'image';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
total: 9753
with_advert: 4095
with_company: 3999
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```bash
run_migration.bat
```

–¢–µ–ø–µ—Ä—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ç–æ–≤–∞—Ä–∞–º! ‚úÖ

---

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

### –ë—ã–ª–æ (—Å—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç):
```python
VALUES (..., NULL, NULL, ...)  # ‚Üê –í—Å–µ —Å–≤—è–∑–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã
```

### –°—Ç–∞–ª–æ (–Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç):
```python
VALUES (..., 11, 5, ...)  # ‚Üê –°–≤—è–∑–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!
```

---

## üñºÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

–¢–µ–ø–µ—Ä—å —Å–∫—Ä–∏–ø—Ç `migrate_from_temp.py` —Å–º–æ–∂–µ—Ç:

```sql
INSERT INTO market.product_images (product_id, image_url, old_id)
SELECT 
    prod_map.new_id as product_id,
    '/uploads/products/original' || tf.path as image_url,
    tf.id as old_id
FROM temp.file tf
JOIN temp.id_mapping prod_map 
    ON prod_map.old_table = 'advert' 
    AND prod_map.old_id = tf.advert_id  -- ‚Üê –¢–µ–ø–µ—Ä—å –ù–ï NULL!
WHERE tf.type = 'image' 
  AND tf.advert_id IS NOT NULL;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~4,095 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ç–æ–≤–∞—Ä–∞–º! üéä

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ —Å–≤—è–∑–µ–π (5,658 —à—Ç—É–∫):
- –≠—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–π (–ª–æ–≥–æ—Ç–∏–ø—ã)
- –ò–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏
- –ò–º –Ω–∞–∑–Ω–∞—á–∞—Ç—Å—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
- –ú–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ `temp.image_mapping`

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å advert_id (4,095 —à—Ç—É–∫):
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∂—É—Ç—Å—è –∫ —Ç–æ–≤–∞—Ä–∞–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è old_id –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞!

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏!

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
setup_categories.bat

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
cd backend
python scripts\setup_images.py

# 3. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
copy "D:\old_system\uploads\*.jpg" "backend\uploads\products\original\"

# 4. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—Ç–µ–ø–µ—Ä—å —Å–æ —Å–≤—è–∑—è–º–∏!)
run_migration.bat
```

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ç–æ–≤–∞—Ä–∞–º!** üéâ
