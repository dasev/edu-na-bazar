# CI/CD Setup –¥–ª—è Edu Na Bazar

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ production —Å–µ—Ä–≤–µ—Ä –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:

### 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret
```

### 2. –î–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

| –ò–º—è —Å–µ–∫—Ä–µ—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `PROD_HOST` | `176.99.5.211` | IP –∞–¥—Ä–µ—Å production —Å–µ—Ä–≤–µ—Ä–∞ |
| `PROD_USER` | `root` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH |
| `PROD_PASSWORD` | `sIAS6APDsKh0bL` | –ü–∞—Ä–æ–ª—å SSH |

## Workflows

### 1. CI - Code Quality Checks (`.github/workflows/ci.yml`)
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ `main` –∏–ª–∏ `develop`, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏ PR:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript
- ‚úÖ –°–±–æ—Ä–∫–∞ frontend
- ‚úÖ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ docker-compose.yml

### 2. Deploy to Production (`.github/workflows/deploy-production.yml`)
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ `main` –∏–ª–∏ –≤—Ä—É—á–Ω—É—é:
- üöÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ production —Å–µ—Ä–≤–µ—Ä—É
- üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (`git pull`)
- üî® –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
- üö¢ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ `Actions` ‚Üí `Deploy to Production`
2. –ù–∞–∂–∞—Ç—å `Run workflow`
3. –í—ã–±—Ä–∞—Ç—å –≤–µ—Ç–∫—É `main`
4. –ù–∞–∂–∞—Ç—å `Run workflow`

## –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
git add .
git commit -m "Feature: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è"
git push origin main

# 2. GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ (CI)
# - –î–µ–ø–ª–æ–∏—Ç –Ω–∞ production (CD)

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production
curl http://176.99.5.211:8000/api/categories/
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

- –õ–æ–≥–∏ –¥–µ–ø–ª–æ—è: `Actions` ‚Üí `Deploy to Production` ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫
- –õ–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `ssh root@176.99.5.211` ‚Üí `docker-compose logs -f`

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/edu-na-bazar
git log --oneline -5
git reset --hard <commit-hash>
docker-compose down
docker-compose up -d --build
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:**
- –°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ GitHub Secrets (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã)
- –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å `.env` —Ñ–∞–π–ª—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## –£–ª—É—á—à–µ–Ω–∏—è (TODO)

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram/Slack
- [ ] –î–æ–±–∞–≤–∏—Ç—å smoke tests –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
