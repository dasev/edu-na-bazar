<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.08);
        }
        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 24px 0;
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
        }
        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #060;
        }
        .info {
            background: #eef;
            border: 1px solid #ccf;
            color: #006;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px 8px 8px 0;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        button.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            box-shadow: none;
        }
        pre {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
        
        <div id="status"></div>
        
        <div style="margin-top: 24px;">
            <button onclick="checkAuth()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <button onclick="fixAuth()">‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å</button>
            <button onclick="clearAll()" class="secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <button onclick="goHome()" class="secondary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
        
        <div id="details" style="margin-top: 24px;"></div>
    </div>

    <script>
        function checkAuth() {
            const status = document.getElementById('status');
            const details = document.getElementById('details');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å –≤ localStorage
            const authToken = localStorage.getItem('auth_token');
            const authStorage = localStorage.getItem('auth-storage');
            const user = localStorage.getItem('user');
            
            let html = '';
            let hasIssues = false;
            
            // –ü–∞—Ä—Å–∏–º auth-storage (zustand)
            let zustandData = null;
            if (authStorage) {
                try {
                    zustandData = JSON.parse(authStorage);
                } catch (e) {
                    html += '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ auth-storage</div>';
                    hasIssues = true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º auth_token
            if (!authToken) {
                html += '<div class="status error">‚ùå –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ localStorage["auth_token"]</div>';
                hasIssues = true;
            } else {
                html += '<div class="status success">‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –≤ localStorage["auth_token"]</div>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º zustand store
            if (zustandData && zustandData.state) {
                if (zustandData.state.token) {
                    html += '<div class="status success">‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –≤ zustand store</div>';
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ —Ç–æ–∫–µ–Ω—ã
                    if (authToken && authToken !== zustandData.state.token) {
                        html += '<div class="status error">‚ùå –¢–æ–∫–µ–Ω—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!</div>';
                        hasIssues = true;
                    }
                } else {
                    html += '<div class="status error">‚ùå –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ zustand store</div>';
                    hasIssues = true;
                }
                
                if (zustandData.state.isAuthenticated) {
                    html += '<div class="status success">‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (zustand)</div>';
                } else {
                    html += '<div class="status error">‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (zustand)</div>';
                    hasIssues = true;
                }
            } else {
                html += '<div class="status error">‚ùå Zustand store –ø—É—Å—Ç</div>';
                hasIssues = true;
            }
            
            status.innerHTML = html;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
            let detailsHtml = '<h3>–î–µ—Ç–∞–ª–∏:</h3>';
            detailsHtml += '<pre>';
            detailsHtml += 'auth_token: ' + (authToken ? authToken.substring(0, 50) + '...' : 'null') + '\n';
            detailsHtml += 'user: ' + (user ? '–µ—Å—Ç—å' : 'null') + '\n';
            detailsHtml += 'auth-storage: ' + (authStorage ? '–µ—Å—Ç—å' : 'null') + '\n';
            if (zustandData) {
                detailsHtml += '\nZustand state:\n' + JSON.stringify(zustandData.state, null, 2);
            }
            detailsHtml += '</pre>';
            
            if (hasIssues) {
                detailsHtml += '<div class="status error">‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã! –ù–∞–∂–º–∏—Ç–µ "–ò—Å–ø—Ä–∞–≤–∏—Ç—å" –∏–ª–∏ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ"</div>';
            } else {
                detailsHtml += '<div class="status success">‚úÖ –í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ! –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è.</div>';
            }
            
            details.innerHTML = detailsHtml;
        }
        
        function fixAuth() {
            const authStorage = localStorage.getItem('auth-storage');
            
            if (!authStorage) {
                alert('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ù–∞–∂–º–∏—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ" –∏ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å.');
                return;
            }
            
            try {
                const zustandData = JSON.parse(authStorage);
                
                if (zustandData.state && zustandData.state.token) {
                    // –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –∏–∑ zustand –≤ auth_token
                    localStorage.setItem('auth_token', zustandData.state.token);
                    
                    if (zustandData.state.user) {
                        localStorage.setItem('user', JSON.stringify(zustandData.state.user));
                    }
                    
                    alert('‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ! –¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ localStorage["auth_token"]. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    checkAuth();
                } else {
                    alert('‚ùå –í zustand store –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ" –∏ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å.');
                }
            } catch (e) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + e.message);
            }
        }
        
        function clearAll() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏? –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.')) {
                localStorage.clear();
                alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã! –°–µ–π—á–∞—Å –ø–µ—Ä–µ–π–¥–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                window.location.href = '/';
            }
        }
        
        function goHome() {
            window.location.href = '/';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = checkAuth;
    </script>
</body>
</html>
