<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1a1a1a;
            margin: 0 0 24px 0;
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
        }
        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #060;
        }
        .info {
            background: #eef;
            border: 1px solid #ccf;
            color: #006;
        }
        button {
            background: #005bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px 8px 8px 0;
        }
        button:hover {
            background: #0047cc;
        }
        pre {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
        
        <div id="status"></div>
        
        <div style="margin-top: 24px;">
            <button onclick="checkToken()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
            <button onclick="testAPI()">üåê –¢–µ—Å—Ç API</button>
            <button onclick="location.href='/'">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
        
        <div id="details" style="margin-top: 24px;"></div>
    </div>

    <script>
        function checkToken() {
            const status = document.getElementById('status');
            const details = document.getElementById('details');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const authToken = localStorage.getItem('auth_token');
            const authStorage = localStorage.getItem('auth-storage');
            const user = localStorage.getItem('user');
            
            let html = '';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º auth_token
            if (!authToken) {
                html += '<div class="status error">‚ùå –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ localStorage["auth_token"]</div>';
            } else {
                html += '<div class="status success">‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –≤ localStorage["auth_token"]</div>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º zustand store
            if (authStorage) {
                try {
                    const zustandData = JSON.parse(authStorage);
                    if (zustandData.state && zustandData.state.token) {
                        html += '<div class="status success">‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –≤ zustand store</div>';
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ —Ç–æ–∫–µ–Ω—ã
                        if (authToken && authToken !== zustandData.state.token) {
                            html += '<div class="status error">‚ùå –¢–æ–∫–µ–Ω—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!</div>';
                        } else {
                            html += '<div class="status success">‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç</div>';
                        }
                    } else {
                        html += '<div class="status error">‚ùå –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ zustand store</div>';
                    }
                } catch (e) {
                    html += '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ auth-storage</div>';
                }
            } else {
                html += '<div class="status error">‚ùå Zustand store –ø—É—Å—Ç</div>';
            }
            
            status.innerHTML = html;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
            let detailsHtml = '<h3>–î–µ—Ç–∞–ª–∏:</h3>';
            detailsHtml += '<pre>';
            detailsHtml += 'auth_token: ' + (authToken ? authToken.substring(0, 50) + '...' : 'null') + '\n';
            detailsHtml += 'user: ' + (user ? '–µ—Å—Ç—å' : 'null') + '\n';
            detailsHtml += 'auth-storage: ' + (authStorage ? '–µ—Å—Ç—å' : 'null') + '\n';
            if (authStorage) {
                try {
                    const zustandData = JSON.parse(authStorage);
                    detailsHtml += '\nZustand state:\n' + JSON.stringify(zustandData.state, null, 2);
                } catch (e) {
                    detailsHtml += '\n–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ zustand';
                }
            }
            detailsHtml += '</pre>';
            
            details.innerHTML = detailsHtml;
        }
        
        async function testAPI() {
            const status = document.getElementById('status');
            const details = document.getElementById('details');
            
            const authToken = localStorage.getItem('auth_token');
            
            if (!authToken) {
                status.innerHTML = '<div class="status error">‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
                return;
            }
            
            status.innerHTML = '<div class="status info">‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API...</div>';
            
            try {
                const response = await fetch('http://localhost:8000/api/my-stores', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    status.innerHTML = '<div class="status success">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –°—Ç–∞—Ç—É—Å: ' + response.status + '</div>';
                    details.innerHTML = '<h3>–û—Ç–≤–µ—Ç API:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    status.innerHTML = '<div class="status error">‚ùå API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ' + response.status + '</div>';
                    details.innerHTML = '<h3>–û—Ç–≤–µ—Ç API:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                status.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ' + error.message + '</div>';
                details.innerHTML = '<h3>–û—à–∏–±–∫–∞:</h3><pre>' + error.toString() + '</pre>';
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = checkToken;
    </script>
</body>
</html>
